pool:
  name: mymachine
  
trigger:
- main


jobs:
  - job: Build_Frontend
    displayName: 'Build Angular Frontend'
    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '20.x'
        displayName: 'Install Node.js'

      - script: |
          cd emp_frontend
          npm install -g @angular/cli
          npm install
          ng build --prod
        displayName: 'npm install and build Angular'

  - job: Build_Backend
    displayName: 'Build Spring Boot Backend'
    steps:
      - task: Maven@3
        inputs:
          mavenPomFile: 'emp_backend/pom.xml'
          goals: 'clean install'
          options: '-DskipTests=true'
        displayName: 'Build Spring Boot Application'

      # Step to run unit tests
      - task: Maven@3
        inputs:
          mavenPomFile: 'emp_backend/pom.xml'
          goals: 'test'  # Runs unit tests
        displayName: 'Run Unit Tests'
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'backend'
          publishLocation: 'Container'
        displayName: 'Publish Backend Build Artifacts'

      - task: SonarQubePrepare@7
        inputs:
          SonarQube: 'sonar service'
          scannerMode: 'other'
          extraProperties: |
            # Additional properties that will be passed to the scanner,
            # Put one key=value per line, example:
            # sonar.exclusions=**/*.bin
            sonar.projectKey=DevOps_DevOps_b8711e8d-58a6-4c0d-958d-8a824d482c00
            sonar.projectName=DevOps